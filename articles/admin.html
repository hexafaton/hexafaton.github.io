<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin | Hexafaton CMS</title>

  <!-- ğŸ”— Fonts + CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/admin.css">

  <!-- ğŸ”— Konfigurasi API -->
  <script src="config.js"></script>
</head>
<body>
  <header>
  <h1>âœï¸ Admin Panel Hexafaton</h1>
  <button onclick="logout()">ğŸšª Logout</button>
  </header>
  <!-- ğŸ” Cek Login -->
  <script>
    if (localStorage.getItem("hexafaton_admin") !== "true") {
      window.location.href = "login.html";
    }
  </script>

  <!-- ğŸ”¹ Tombol Logout -->
  <div style="text-align:right; max-width:700px; margin:auto;">
    <button onclick="logout()" style="background:#e63946;">ğŸšª Logout</button>
  </div>

  <h1>âœï¸ Admin Panel Hexafaton</h1>

  <!-- ğŸ”¹ Form Tambah/Edit Artikel -->
  <form id="articleForm">
    <input type="hidden" id="articleId">
    <label for="title">Judul Artikel</label>
    <input type="text" id="title" placeholder="Masukkan judul artikel" required>

    <label for="content">Isi Artikel</label>
    <textarea id="content" placeholder="Tulis isi artikel di sini..." required></textarea>

    <button type="submit">ğŸ’¾ Simpan</button>
    <button type="button" id="cancelEdit" style="display:none;background:#ccc;color:#000;">Batal</button>
    <div class="status" id="status"></div>
  </form>

  <!-- ğŸ”¹ Daftar Artikel -->
  <div class="article-list" id="articleList">
    <h2>ğŸ“° Daftar Artikel</h2>
    <div id="listContainer">Memuat data...</div>
  </div>

  <!-- ======================= SCRIPT ======================= -->
  <script>
    const form = document.getElementById("articleForm");
    const listContainer = document.getElementById("listContainer");
    const cancelEditBtn = document.getElementById("cancelEdit");
    const status = document.getElementById("status");

    // ğŸ§© Load semua artikel
    async function loadArticles() {
      listContainer.innerHTML = "â³ Memuat artikel...";
      try {
        const res = await fetch(API_URL + "/api/articles");
        const data = await res.json();

        if (!data.length) {
          listContainer.innerHTML = "<p>Belum ada artikel.</p>";
          return;
        }

        listContainer.innerHTML = "";
        data.forEach(a => {
          const div = document.createElement("div");
          div.className = "article-item";
          div.innerHTML = `
            <h3>${a.title}</h3>
            <p>${a.content.substring(0,120)}...</p>
            <div class="actions">
              <button class="edit" onclick="editArticle('${a.id}')">âœï¸ Edit</button>
              <button class="delete" onclick="deleteArticle('${a.id}')">ğŸ—‘ï¸ Hapus</button>
            </div>
          `;
          listContainer.appendChild(div);
        });
      } catch (err) {
        listContainer.innerHTML = "âŒ Gagal memuat artikel.";
        console.error(err);
      }
    }

    // ğŸ§© Tambah atau Update Artikel
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      status.textContent = "â³ Menyimpan...";

      const id = document.getElementById("articleId").value || Date.now().toString();
      const data = {
        id,
        title: document.getElementById("title").value.trim(),
        content: document.getElementById("content").value.trim(),
        date: new Date().toISOString()
      };

      try {
        const res = await fetch(API_URL + "/api/articles", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        if (res.ok) {
          status.textContent = "âœ… Artikel berhasil disimpan!";
          form.reset();
          document.getElementById("articleId").value = "";
          cancelEditBtn.style.display = "none";
          loadArticles();
        } else {
          status.textContent = "âŒ Gagal menyimpan artikel.";
        }
      } catch (err) {
        status.textContent = "âš ï¸ Terjadi kesalahan jaringan.";
        console.error(err);
      }
    });

    // ğŸ§© Edit Artikel
    window.editArticle = async (id) => {
      try {
        const res = await fetch(API_URL + "/api/articles");
        const data = await res.json();
        const article = data.find(a => a.id === id);
        if (!article) return alert("Artikel tidak ditemukan!");

        document.getElementById("articleId").value = article.id;
        document.getElementById("title").value = article.title;
        document.getElementById("content").value = article.content;
        cancelEditBtn.style.display = "inline-block";
      } catch (err) {
        console.error(err);
      }
    };

    // ğŸ§© Batal Edit
    cancelEditBtn.addEventListener("click", () => {
      form.reset();
      document.getElementById("articleId").value = "";
      cancelEditBtn.style.display = "none";
    });

    // ğŸ§© Hapus Artikel
    window.deleteArticle = async (id) => {
      if (!confirm("Yakin ingin menghapus artikel ini?")) return;
      try {
        const res = await fetch(API_URL + "/api/delete?id=" + id, { method: "DELETE" });
        if (res.ok) {
          alert("ğŸ—‘ï¸ Artikel dihapus!");
          loadArticles();
        } else {
          alert("âŒ Gagal menghapus artikel.");
        }
      } catch (err) {
        alert("âš ï¸ Terjadi kesalahan jaringan.");
        console.error(err);
      }
    };

    // ğŸ§© Logout
    function logout() {
      localStorage.removeItem("hexafaton_admin");
      window.location.href = "login.html";
    }

    // Jalankan saat halaman dibuka
    loadArticles();
  </script>
  <footer>
  <p>Â© 2025 Hexafaton | Dibangun dengan â¤ï¸ dan GitHub Pages</p>
  </footer>
</body>
</html>
